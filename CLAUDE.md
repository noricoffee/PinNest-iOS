# pinNest — Claude 向けプロジェクト設定

このファイルは Claude Code が毎回自動的に読み込むプロジェクト設定です。
以下の方針・規約を常に前提としてコードを生成・レビューしてください。

---

# 基礎ルール（すべてのタスクに適用）

## ワークフロー・オーケストレーション

### 1. Plan Node Default（プランモードをデフォルトに）

- 非自明なタスク（3ステップ以上、またはアーキテクチャの意思決定）には必ずプランモードに入ること
- 何かがうまくいかなくなったら、すぐに止めて再計画する。そのまま進め続けない
- 構築だけでなく、検証ステップにもプランモードを使う
- 曖昧さを減らすために、詳細な仕様を最初に書く

### 2. Subagent Strategy（サブエージェント戦略）

- メインのコンテキストウィンドウをクリーンに保つため、サブエージェントを積極的に活用する
- リサーチ・探索・並列分析はサブエージェントにオフロードする
- 複雑な問題には、サブエージェントを通じてより多くの計算リソースを投入する
- サブエージェント1つにつきタスクは1つ（集中した実行のため）

### 3. Self-Improvement Loop（自己改善ループ）

- ユーザーからの修正があったら必ず `docs/tasks/lessons.md` にパターンを記録する
- 同じミスを繰り返さないためのルールを自分のために書く
- セッション開始時に、関連プロジェクトの教訓を見直す

### 4. Verification Before Done（完了前の検証）

- 動作を証明せずにタスクを完了済みにしない
- 必要に応じて、main と自分の変更の差分を確認する
- 「スタッフエンジニアはこれを承認するか？」と自問する
- テストを実行し、ログを確認し、正確性を実証する

### 5. Demand Elegance（エレガンスを求める）

- 非自明な変更では「より洗練された方法はないか？」と立ち止まって考える
- 修正がハック的に感じたら「今知っていることをすべて踏まえて、エレガントな解決策を実装する」
- 単純・明快な修正にはこれをスキップする。過剰設計しない
- 提示する前に、自分の作業に自ら異議を唱える

### 6. Autonomous Bug Fixing（自律的なバグ修正）

- バグレポートが来たら：すぐに直す。手取り足取りを求めない
- ログ・エラー・失敗テストを指摘し、それを解決する
- ユーザーからのコンテキスト切り替えはゼロ
- 方法を指示されずとも、失敗している CI テストを修正しに行く

---

## タスク管理

1. **Plan First**: チェック可能な項目を `docs/tasks/todo.md` に書く
2. **Verify Plan**: 実装を始める前に確認する
3. **Track Progress**: 完了したら随時チェックマークを付ける
4. **Explain Changes**: 各ステップで高レベルのサマリーを示す
5. **Document Results**: `docs/tasks/todo.md` にレビューセクションを追加する
6. **Capture Lessons**: 修正後に `docs/tasks/lessons.md` を更新する

---

## 核となる原則

- **Simplicity First（シンプルさ優先）**: すべての変更をできる限りシンプルに。影響するコードを最小限に
- **No Laziness（怠けるな）**: 根本原因を探る。一時的な修正はしない。シニアデベロッパーの基準で
- **Minimal Impact（最小限の影響）**: 変更は必要なものだけに触れる。バグを持ち込まない

---

# プロジェクト固有ルール（pinNest）

## プロジェクト概要

- **アプリ名**: pinNest
- **プラットフォーム**: iOS
- **ターゲット OS**: iOS 26.1 以上
- **言語**: Swift 6
- **UI フレームワーク**: SwiftUI
- **アーキテクチャ**: The Composable Architecture（TCA）
- **テストフレームワーク**: Swift Testing（`@Suite` / `@Test`）

---

## 必読ドキュメント

コードの生成・変更を行う際は、必ず以下の方針に従ってください。

| ドキュメント | 内容 | パス |
|-------------|------|------|
| アーキテクチャ方針 | TCA の設計・実装パターン | `docs/architecture.md` |
| コーディング規約 | 命名・ファイル構成・実装ルール | `docs/coding-conventions.md` |
| UI/UX ガイドライン | Apple HIG ベースの UI 設計方針 | `docs/ui-ux-guidelines.md` |
| 要件定義 | 機能一覧・画面一覧・非機能要件 | `docs/requirements.md` |
| タスク一覧 | フェーズ別タスク・進捗管理 | `docs/tasks.md` |

---

## 重要なルール（抜粋）

### アーキテクチャ

- すべての機能は `@Reducer` で実装する（State / Action / body の順に記述）
- ビジネスロジックは Reducer に集約し、View には書かない
- 副作用は `Effect` に隔離し、`@Dependency` 経由で注入する
- 画面遷移は TCA の `@Presents` / `NavigationStack` で管理する

### コーディング規約

- Reducer は `<機能名>Reducer`、View は `<機能名>View` と命名する
- Action の case はユーザー操作を `<UI要素><動詞>`（例: `addButtonTapped`）、Effect 結果を `<処理名>Response` とする
- `switch` の `default` は使用しない。全 case を網羅する
- テストは `TestStore` + `@Suite` / `@Test` で記述する

### UI/UX

- カラーはシステムカラー（`.primary` / `Color(.systemBackground)` など）を優先する
- フォントは Dynamic Type スタイル（`.body` / `.headline` など）を使用する
- スペーシングは 8pt グリッドを基準にする
- タップ可能な要素の最小サイズは 44×44pt を確保する
- SF Symbols をアイコンとして使用する
- アクセシビリティラベルをすべてのインタラクティブ要素に付与する

---

## ディレクトリ構成

```
pinNest/
├── App/          # @main エントリポイント・AppReducer
├── Features/     # 機能ごとのディレクトリ（<機能名>Reducer.swift / <機能名>View.swift）
├── Shared/       # Models / APIClient / Extensions
└── docs/         # プロジェクトドキュメント
```

---

## コード生成時のチェックリスト

- [ ] Reducer に State / Action / body が揃っているか
- [ ] Action の命名規則に従っているか
- [ ] View にビジネスロジックが混入していないか
- [ ] `switch` で全 case を網羅しているか（`default` を使っていないか）
- [ ] システムカラー・Dynamic Type を使用しているか
- [ ] アクセシビリティラベルが付与されているか
- [ ] テストは `TestStore` + `@Suite` / `@Test` で書かれているか
